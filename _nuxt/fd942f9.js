/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{583:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(175);class o extends n.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new f(e)})),this.register((function(e){return new x(e)})),this.register((function(e){return new M(e)})),this.register((function(e){return new _(e)})),this.register((function(e){return new y(e)})),this.register((function(e){return new E(e)})),this.register((function(e){return new T(e)})),this.register((function(e){return new m(e)})),this.register((function(e){return new v(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new R(e)}))}load(e,t,r,o){const h=this;let c;c=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:n.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);const l=function(t){o?o(t):console.error(t),h.manager.itemError(e),h.manager.itemEnd(e)},d=new n.FileLoader(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(e,(function(data){try{h.parse(data,c,(function(r){t(r),h.manager.itemEnd(e)}),l)}catch(e){l(e)}}),r,l)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(data,path,e,t){let content;const r={},o={};if("string"==typeof data)content=data;else{if(n.LoaderUtils.decodeText(new Uint8Array(data,0,4))===w){try{r[c.KHR_BINARY_GLTF]=new S(data)}catch(e){return void(t&&t(e))}content=r[c.KHR_BINARY_GLTF].content}else content=n.LoaderUtils.decodeText(new Uint8Array(data))}const h=JSON.parse(content);if(void 0===h.asset||h.asset.version[0]<2)return void(t&&t(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new he(h,{path:path||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let i=0;i<this.pluginCallbacks.length;i++){const e=this.pluginCallbacks[i](l);o[e.name]=e,r[e.name]=!0}if(h.extensionsUsed)for(let i=0;i<h.extensionsUsed.length;++i){const e=h.extensionsUsed[i],t=h.extensionsRequired||[];switch(e){case c.KHR_MATERIALS_UNLIT:r[e]=new d;break;case c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:r[e]=new U;break;case c.KHR_DRACO_MESH_COMPRESSION:r[e]=new L(h,this.dracoLoader);break;case c.KHR_TEXTURE_TRANSFORM:r[e]=new C;break;case c.KHR_MESH_QUANTIZATION:r[e]=new F;break;default:t.indexOf(e)>=0&&void 0===o[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(r),l.setPlugins(o),l.parse(e,t)}parseAsync(data,path){const e=this;return new Promise((function(t,r){e.parse(data,path,t,r)}))}}function h(){let e={};return{get:function(t){return e[t]},add:function(t,object){e[t]=object},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const c={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class l{constructor(e){this.parser=e,this.name=c.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,n=t.length;r<n;r++){const n=t[r];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,r="light:"+e;let o=t.cache.get(r);if(o)return o;const h=t.json,c=((h.extensions&&h.extensions[this.name]||{}).lights||[])[e];let l;const d=new n.Color(16777215);void 0!==c.color&&d.fromArray(c.color);const m=void 0!==c.range?c.range:0;switch(c.type){case"directional":l=new n.DirectionalLight(d),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new n.PointLight(d),l.distance=m;break;case"spot":l=new n.SpotLight(d),l.distance=m,c.spot=c.spot||{},c.spot.innerConeAngle=void 0!==c.spot.innerConeAngle?c.spot.innerConeAngle:0,c.spot.outerConeAngle=void 0!==c.spot.outerConeAngle?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),l.decay=2,void 0!==c.intensity&&(l.intensity=c.intensity),l.name=t.createUniqueName(c.name||"light_"+e),o=Promise.resolve(l),t.cache.add(r,o),o}createNodeAttachment(e){const t=this,r=this.parser,n=r.json.nodes[e],o=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===o?null:this._loadLight(o).then((function(e){return r._getNodeRef(t.cache,o,e)}))}}class d{constructor(){this.name=c.KHR_MATERIALS_UNLIT}getMaterialType(){return n.MeshBasicMaterial}extendParams(e,t,r){const o=[];e.color=new n.Color(1,1,1),e.opacity=1;const h=t.pbrMetallicRoughness;if(h){if(Array.isArray(h.baseColorFactor)){const t=h.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==h.baseColorTexture&&o.push(r.assignTexture(e,"map",h.baseColorTexture,n.sRGBEncoding))}return Promise.all(o)}}class m{constructor(e){this.parser=e,this.name=c.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=r.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}}class f{constructor(e){this.parser=e,this.name=c.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,o=r.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const h=[],c=o.extensions[this.name];if(void 0!==c.clearcoatFactor&&(t.clearcoat=c.clearcoatFactor),void 0!==c.clearcoatTexture&&h.push(r.assignTexture(t,"clearcoatMap",c.clearcoatTexture)),void 0!==c.clearcoatRoughnessFactor&&(t.clearcoatRoughness=c.clearcoatRoughnessFactor),void 0!==c.clearcoatRoughnessTexture&&h.push(r.assignTexture(t,"clearcoatRoughnessMap",c.clearcoatRoughnessTexture)),void 0!==c.clearcoatNormalTexture&&(h.push(r.assignTexture(t,"clearcoatNormalMap",c.clearcoatNormalTexture)),void 0!==c.clearcoatNormalTexture.scale)){const e=c.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new n.Vector2(e,e)}return Promise.all(h)}}class _{constructor(e){this.parser=e,this.name=c.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,o=r.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const h=[];t.sheenColor=new n.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;const c=o.extensions[this.name];return void 0!==c.sheenColorFactor&&t.sheenColor.fromArray(c.sheenColorFactor),void 0!==c.sheenRoughnessFactor&&(t.sheenRoughness=c.sheenRoughnessFactor),void 0!==c.sheenColorTexture&&h.push(r.assignTexture(t,"sheenColorMap",c.sheenColorTexture,n.sRGBEncoding)),void 0!==c.sheenRoughnessTexture&&h.push(r.assignTexture(t,"sheenRoughnessMap",c.sheenRoughnessTexture)),Promise.all(h)}}class y{constructor(e){this.parser=e,this.name=c.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],h=n.extensions[this.name];return void 0!==h.transmissionFactor&&(t.transmission=h.transmissionFactor),void 0!==h.transmissionTexture&&o.push(r.assignTexture(t,"transmissionMap",h.transmissionTexture)),Promise.all(o)}}class E{constructor(e){this.parser=e,this.name=c.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,o=r.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const h=[],c=o.extensions[this.name];t.thickness=void 0!==c.thicknessFactor?c.thicknessFactor:0,void 0!==c.thicknessTexture&&h.push(r.assignTexture(t,"thicknessMap",c.thicknessTexture)),t.attenuationDistance=c.attenuationDistance||0;const l=c.attenuationColor||[1,1,1];return t.attenuationColor=new n.Color(l[0],l[1],l[2]),Promise.all(h)}}class T{constructor(e){this.parser=e,this.name=c.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=r.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class v{constructor(e){this.parser=e,this.name=c.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,o=r.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const h=[],c=o.extensions[this.name];t.specularIntensity=void 0!==c.specularFactor?c.specularFactor:1,void 0!==c.specularTexture&&h.push(r.assignTexture(t,"specularIntensityMap",c.specularTexture));const l=c.specularColorFactor||[1,1,1];return t.specularColor=new n.Color(l[0],l[1],l[2]),void 0!==c.specularColorTexture&&h.push(r.assignTexture(t,"specularColorMap",c.specularColorTexture,n.sRGBEncoding)),Promise.all(h)}}class x{constructor(e){this.parser=e,this.name=c.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,r=t.json,n=r.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const o=n.extensions[this.name],h=t.options.ktx2Loader;if(!h){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,h)}}class M{constructor(e){this.parser=e,this.name=c.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,n=r.json,o=n.textures[e];if(!o.extensions||!o.extensions[t])return null;const h=o.extensions[t],source=n.images[h.source];let c=r.textureLoader;if(source.uri){const e=r.options.manager.getHandler(source.uri);null!==e&&(c=e)}return this.detectSupport().then((function(o){if(o)return r.loadTextureImage(e,h.source,c);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const image=new Image;image.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",image.onload=image.onerror=function(){e(1===image.height)}}))),this.isSupported}}class R{constructor(e){this.name=c.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const e=r.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([n,o.ready]).then((function(t){const r=e.byteOffset||0,n=e.byteLength||0,h=e.count,c=e.byteStride,l=new ArrayBuffer(h*c),source=new Uint8Array(t[0],r,n);return o.decodeGltfBuffer(new Uint8Array(l),h,c,source,e.mode,e.filter),l}))}return null}}const w="glTF",O=1313821514,A=5130562;class S{constructor(data){this.name=c.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(data,0,12);if(this.header={magic:n.LoaderUtils.decodeText(new Uint8Array(data.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==w)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const t=this.header.length-12,r=new DataView(data,12);let o=0;for(;o<t;){const e=r.getUint32(o,!0);o+=4;const t=r.getUint32(o,!0);if(o+=4,t===O){const t=new Uint8Array(data,12+o,e);this.content=n.LoaderUtils.decodeText(t)}else if(t===A){const t=12+o;this.body=data.slice(t,t+e)}o+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class L{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=c.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const r=this.json,n=this.dracoLoader,o=e.extensions[this.name].bufferView,h=e.extensions[this.name].attributes,c={},l={},d={};for(const e in h){const t=Q[e]||e.toLowerCase();c[t]=h[e]}for(const t in e.attributes){const n=Q[t]||t.toLowerCase();if(void 0!==h[t]){const o=r.accessors[e.attributes[t]],h=j[o.componentType];d[n]=h,l[n]=!0===o.normalized}}return t.getDependency("bufferView",o).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(const t in e.attributes){const r=e.attributes[t],n=l[t];void 0!==n&&(r.normalized=n)}t(e)}),c,d)}))}))}}class C{constructor(){this.name=c.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class P extends n.MeshStandardMaterial{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),o=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),h=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),c=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),l={specular:{value:(new n.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=l,this.onBeforeCompile=function(e){for(const t in l)e.uniforms[t]=l[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",o).replace("#include <metalnessmap_fragment>",h).replace("#include <lights_physical_fragment>",c)},Object.defineProperties(this,{specular:{get:function(){return l.specular.value},set:function(e){l.specular.value=e}},specularMap:{get:function(){return l.specularMap.value},set:function(e){l.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return l.glossiness.value},set:function(e){l.glossiness.value=e}},glossinessMap:{get:function(){return l.glossinessMap.value},set:function(e){l.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(source){return super.copy(source),this.specularMap=source.specularMap,this.specular.copy(source.specular),this.glossinessMap=source.glossinessMap,this.glossiness=source.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class U{constructor(){this.name=c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return P}extendParams(e,t,r){const o=t.extensions[this.name];e.color=new n.Color(1,1,1),e.opacity=1;const h=[];if(Array.isArray(o.diffuseFactor)){const t=o.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==o.diffuseTexture&&h.push(r.assignTexture(e,"map",o.diffuseTexture,n.sRGBEncoding)),e.emissive=new n.Color(0,0,0),e.glossiness=void 0!==o.glossinessFactor?o.glossinessFactor:1,e.specular=new n.Color(1,1,1),Array.isArray(o.specularFactor)&&e.specular.fromArray(o.specularFactor),void 0!==o.specularGlossinessTexture){const t=o.specularGlossinessTexture;h.push(r.assignTexture(e,"glossinessMap",t)),h.push(r.assignTexture(e,"specularMap",t,n.sRGBEncoding))}return Promise.all(h)}createMaterial(e){const t=new P(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=void 0===e.emissiveIntensity?1:e.emissiveIntensity,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=n.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t}}class F{constructor(){this.name=c.KHR_MESH_QUANTIZATION}}class I extends n.Interpolant{constructor(e,t,r,n){super(e,t,r,n)}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,o=e*n*3+n;for(let i=0;i!==n;i++)t[i]=r[o+i];return t}}I.prototype.beforeStart_=I.prototype.copySampleValue_,I.prototype.afterEnd_=I.prototype.copySampleValue_,I.prototype.interpolate_=function(e,t,r,n){const o=this.resultBuffer,h=this.sampleValues,c=this.valueSize,l=2*c,d=3*c,td=n-t,p=(r-t)/td,m=p*p,f=m*p,_=e*d,y=_-d,E=-2*f+3*m,T=f-m,v=1-E,x=T-m+p;for(let i=0;i!==c;i++){const e=h[y+i+c],t=h[y+i+l]*td,r=h[_+i+c],n=h[_+i]*td;o[i]=v*e+x*t+E*r+T*n}return o};const D=new n.Quaternion;class H extends I{interpolate_(e,t,r,n){const o=super.interpolate_(e,t,r,n);return D.fromArray(o).normalize().toArray(o),o}}const N=0,k=1,z=2,B=3,V=4,K=5,G=6,j={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},X={9728:n.NearestFilter,9729:n.LinearFilter,9984:n.NearestMipmapNearestFilter,9985:n.LinearMipmapNearestFilter,9986:n.NearestMipmapLinearFilter,9987:n.LinearMipmapLinearFilter},Y={33071:n.ClampToEdgeWrapping,33648:n.MirroredRepeatWrapping,10497:n.RepeatWrapping},Z={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Q={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},W={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},J={CUBICSPLINE:void 0,LINEAR:n.InterpolateLinear,STEP:n.InterpolateDiscrete},$="OPAQUE",ee="MASK",te="BLEND";function se(e,object,t){for(const r in t.extensions)void 0===e[r]&&(object.userData.gltfExtensions=object.userData.gltfExtensions||{},object.userData.gltfExtensions[r]=t.extensions[r])}function ie(object,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(object.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function re(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let i=0,r=t.weights.length;i<r;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){const r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(let i=0,t=r.length;i<t;i++)e.morphTargetDictionary[r[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ne(e){const t=e.extensions&&e.extensions[c.KHR_DRACO_MESH_COMPRESSION];let r;return r=t?"draco:"+t.bufferView+":"+t.indices+":"+oe(t.attributes):e.indices+":"+oe(e.attributes)+":"+e.mode,r}function oe(e){let t="";const r=Object.keys(e).sort();for(let i=0,n=r.length;i<n;i++)t+=r[i]+":"+e[r[i]]+";";return t}function ae(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class he{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new h,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const r=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),o=navigator.userAgent.indexOf("Firefox")>-1,c=o?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;"undefined"==typeof createImageBitmap||r||o&&c<98?this.textureLoader=new n.TextureLoader(this.options.manager):this.textureLoader=new n.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new n.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const r=this,n=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])})).then((function(t){const h={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:r,userData:{}};se(o,h,n),ie(h,n),Promise.all(r._invokeAll((function(e){return e.afterRoot&&e.afterRoot(h)}))).then((function(){e(h)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let r=0,n=t.length;r<n;r++){const n=t[r].joints;for(let i=0,t=n.length;i<t;i++)e[n[i]].isBone=!0}for(let t=0,n=e.length;t<n;t++){const n=e[t];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(r[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,object){if(e.refs[t]<=1)return object;const r=object.clone(),n=(e,t)=>{const r=this.associations.get(e);null!=r&&this.associations.set(t,r);for(const[i,r]of e.children.entries())n(r,t.children[i])};return n(object,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const r=e(t[i]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const r=[];for(let i=0;i<t.length;i++){const n=e(t[i]);n&&r.push(n)}return r}getDependency(e,t){const r=e+":"+t;let n=this.cache.get(r);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const r=this,defs=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(defs.map((function(t,n){return r.getDependency(e,n)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[c.KHR_BINARY_GLTF].body);const o=this.options;return new Promise((function(e,h){r.load(n.LoaderUtils.resolveURL(t.uri,o.path),e,void 0,(function(){h(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)}))}loadAccessor(e){const t=this,r=this.json,o=this.json.accessors[e];if(void 0===o.bufferView&&void 0===o.sparse)return Promise.resolve(null);const h=[];return void 0!==o.bufferView?h.push(this.getDependency("bufferView",o.bufferView)):h.push(null),void 0!==o.sparse&&(h.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),h.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(h).then((function(e){const h=e[0],c=Z[o.type],l=j[o.componentType],d=l.BYTES_PER_ELEMENT,m=d*c,f=o.byteOffset||0,_=void 0!==o.bufferView?r.bufferViews[o.bufferView].byteStride:void 0,y=!0===o.normalized;let E,T;if(_&&_!==m){const e=Math.floor(f/_),r="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+e+":"+o.count;let m=t.cache.get(r);m||(E=new l(h,e*_,o.count*_/d),m=new n.InterleavedBuffer(E,_/d),t.cache.add(r,m)),T=new n.InterleavedBufferAttribute(m,c,f%_/d,y)}else E=null===h?new l(o.count*c):new l(h,f,o.count*c),T=new n.BufferAttribute(E,c,y);if(void 0!==o.sparse){const t=Z.SCALAR,r=j[o.sparse.indices.componentType],d=o.sparse.indices.byteOffset||0,m=o.sparse.values.byteOffset||0,f=new r(e[1],d,o.sparse.count*t),_=new l(e[2],m,o.sparse.count*c);null!==h&&(T=new n.BufferAttribute(T.array.slice(),T.itemSize,T.normalized));for(let i=0,e=f.length;i<e;i++){const e=f[i];if(T.setX(e,_[i*c]),c>=2&&T.setY(e,_[i*c+1]),c>=3&&T.setZ(e,_[i*c+2]),c>=4&&T.setW(e,_[i*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return T}))}loadTexture(e){const t=this.json,r=this.options,n=t.textures[e].source,o=t.images[n];let h=this.textureLoader;if(o.uri){const e=r.manager.getHandler(o.uri);null!==e&&(h=e)}return this.loadTextureImage(e,n,h)}loadTextureImage(e,t,r){const o=this,h=this.json,c=h.textures[e],l=h.images[t],d=(l.uri||l.bufferView)+":"+c.sampler;if(this.textureCache[d])return this.textureCache[d];const m=this.loadImageSource(t,r).then((function(t){t.flipY=!1,c.name&&(t.name=c.name);const r=(h.samplers||{})[c.sampler]||{};return t.magFilter=X[r.magFilter]||n.LinearFilter,t.minFilter=X[r.minFilter]||n.LinearMipmapLinearFilter,t.wrapS=Y[r.wrapS]||n.RepeatWrapping,t.wrapT=Y[r.wrapT]||n.RepeatWrapping,o.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[d]=m,m}loadImageSource(e,t){const r=this,o=this.json,h=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const c=o.images[e],l=self.URL||self.webkitURL;let d=c.uri||"",m=!1;if(void 0!==c.bufferView)d=r.getDependency("bufferView",c.bufferView).then((function(e){m=!0;const t=new Blob([e],{type:c.mimeType});return d=l.createObjectURL(t),d}));else if(void 0===c.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(d).then((function(e){return new Promise((function(r,o){let c=r;!0===t.isImageBitmapLoader&&(c=function(e){const t=new n.Texture(e);t.needsUpdate=!0,r(t)}),t.load(n.LoaderUtils.resolveURL(e,h.path),c,void 0,o)}))})).then((function(e){var t;return!0===m&&l.revokeObjectURL(d),e.userData.mimeType=c.mimeType||((t=c.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",d),e}));return this.sourceCache[e]=f,f}assignTexture(e,t,r,n){const o=this;return this.getDependency("texture",r.index).then((function(h){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===t&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+t+" not yet supported."),o.extensions[c.KHR_TEXTURE_TRANSFORM]){const e=void 0!==r.extensions?r.extensions[c.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=o.associations.get(h);h=o.extensions[c.KHR_TEXTURE_TRANSFORM].extendTexture(h,e),o.associations.set(h,t)}}return void 0!==n&&(h.encoding=n),e[t]=h,h}))}assignFinalMaterial(e){const t=e.geometry;let r=e.material;const o=void 0===t.attributes.tangent,h=void 0!==t.attributes.color,c=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+r.uuid;let t=this.cache.get(e);t||(t=new n.PointsMaterial,n.Material.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,t.sizeAttenuation=!1,this.cache.add(e,t)),r=t}else if(e.isLine){const e="LineBasicMaterial:"+r.uuid;let t=this.cache.get(e);t||(t=new n.LineBasicMaterial,n.Material.prototype.copy.call(t,r),t.color.copy(r.color),this.cache.add(e,t)),r=t}if(o||h||c){let e="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),o&&(e+="derivative-tangents:"),h&&(e+="vertex-colors:"),c&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=r.clone(),h&&(t.vertexColors=!0),c&&(t.flatShading=!0),o&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}r.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=r}getMaterialType(){return n.MeshStandardMaterial}loadMaterial(e){const t=this,r=this.json,o=this.extensions,h=r.materials[e];let l;const d={},m=h.extensions||{},f=[];if(m[c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=o[c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];l=e.getMaterialType(),f.push(e.extendParams(d,h,t))}else if(m[c.KHR_MATERIALS_UNLIT]){const e=o[c.KHR_MATERIALS_UNLIT];l=e.getMaterialType(),f.push(e.extendParams(d,h,t))}else{const r=h.pbrMetallicRoughness||{};if(d.color=new n.Color(1,1,1),d.opacity=1,Array.isArray(r.baseColorFactor)){const e=r.baseColorFactor;d.color.fromArray(e),d.opacity=e[3]}void 0!==r.baseColorTexture&&f.push(t.assignTexture(d,"map",r.baseColorTexture,n.sRGBEncoding)),d.metalness=void 0!==r.metallicFactor?r.metallicFactor:1,d.roughness=void 0!==r.roughnessFactor?r.roughnessFactor:1,void 0!==r.metallicRoughnessTexture&&(f.push(t.assignTexture(d,"metalnessMap",r.metallicRoughnessTexture)),f.push(t.assignTexture(d,"roughnessMap",r.metallicRoughnessTexture))),l=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),f.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,d)}))))}!0===h.doubleSided&&(d.side=n.DoubleSide);const _=h.alphaMode||$;if(_===te?(d.transparent=!0,d.depthWrite=!1):(d.transparent=!1,_===ee&&(d.alphaTest=void 0!==h.alphaCutoff?h.alphaCutoff:.5)),void 0!==h.normalTexture&&l!==n.MeshBasicMaterial&&(f.push(t.assignTexture(d,"normalMap",h.normalTexture)),d.normalScale=new n.Vector2(1,1),void 0!==h.normalTexture.scale)){const e=h.normalTexture.scale;d.normalScale.set(e,e)}return void 0!==h.occlusionTexture&&l!==n.MeshBasicMaterial&&(f.push(t.assignTexture(d,"aoMap",h.occlusionTexture)),void 0!==h.occlusionTexture.strength&&(d.aoMapIntensity=h.occlusionTexture.strength)),void 0!==h.emissiveFactor&&l!==n.MeshBasicMaterial&&(d.emissive=(new n.Color).fromArray(h.emissiveFactor)),void 0!==h.emissiveTexture&&l!==n.MeshBasicMaterial&&f.push(t.assignTexture(d,"emissiveMap",h.emissiveTexture,n.sRGBEncoding)),Promise.all(f).then((function(){let r;return r=l===P?o[c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(d):new l(d),h.name&&(r.name=h.name),ie(r,h),t.associations.set(r,{materials:e}),h.extensions&&se(o,r,h),r}))}createUniqueName(e){const t=n.PropertyBinding.sanitizeNodeName(e||"");let r=t;for(let i=1;this.nodeNamesUsed[r];++i)r=t+"_"+i;return this.nodeNamesUsed[r]=!0,r}loadGeometries(e){const t=this,r=this.extensions,o=this.primitiveCache;function h(e){return r[c.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(r){return le(r,e,t)}))}const l=[];for(let i=0,r=e.length;i<r;i++){const r=e[i],d=ne(r),m=o[d];if(m)l.push(m.promise);else{let e;e=r.extensions&&r.extensions[c.KHR_DRACO_MESH_COMPRESSION]?h(r):le(new n.BufferGeometry,r,t),o[d]={primitive:r,promise:e},l.push(e)}}return Promise.all(l)}loadMesh(e){const t=this,r=this.json,o=this.extensions,h=r.meshes[e],c=h.primitives,l=[];for(let i=0,e=c.length;i<e;i++){const e=void 0===c[i].material?(void 0===(d=this.cache).DefaultMaterial&&(d.DefaultMaterial=new n.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:n.FrontSide})),d.DefaultMaterial):this.getDependency("material",c[i].material);l.push(e)}var d;return l.push(t.loadGeometries(c)),Promise.all(l).then((function(r){const l=r.slice(0,r.length-1),d=r[r.length-1],m=[];for(let i=0,r=d.length;i<r;i++){const r=d[i],f=c[i];let _;const y=l[i];if(f.mode===V||f.mode===K||f.mode===G||void 0===f.mode)_=!0===h.isSkinnedMesh?new n.SkinnedMesh(r,y):new n.Mesh(r,y),!0!==_.isSkinnedMesh||_.geometry.attributes.skinWeight.normalized||_.normalizeSkinWeights(),f.mode===K?_.geometry=ue(_.geometry,n.TriangleStripDrawMode):f.mode===G&&(_.geometry=ue(_.geometry,n.TriangleFanDrawMode));else if(f.mode===k)_=new n.LineSegments(r,y);else if(f.mode===B)_=new n.Line(r,y);else if(f.mode===z)_=new n.LineLoop(r,y);else{if(f.mode!==N)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+f.mode);_=new n.Points(r,y)}Object.keys(_.geometry.morphAttributes).length>0&&re(_,h),_.name=t.createUniqueName(h.name||"mesh_"+e),ie(_,h),f.extensions&&se(o,_,f),t.assignFinalMaterial(_),m.push(_)}for(let i=0,r=m.length;i<r;i++)t.associations.set(m[i],{meshes:e,primitives:i});if(1===m.length)return m[0];const f=new n.Group;t.associations.set(f,{meshes:e});for(let i=0,e=m.length;i<e;i++)f.add(m[i]);return f}))}loadCamera(e){let t;const r=this.json.cameras[e],o=r[r.type];if(o)return"perspective"===r.type?t=new n.PerspectiveCamera(n.MathUtils.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):"orthographic"===r.type&&(t=new n.OrthographicCamera(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),ie(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return r.inverseBindMatrices=e,r}))}loadAnimation(e){const t=this.json.animations[e],r=[],o=[],h=[],c=[],l=[];for(let i=0,e=t.channels.length;i<e;i++){const e=t.channels[i],n=t.samplers[e.sampler],d=e.target,m=void 0!==d.node?d.node:d.id,input=void 0!==t.parameters?t.parameters[n.input]:n.input,output=void 0!==t.parameters?t.parameters[n.output]:n.output;r.push(this.getDependency("node",m)),o.push(this.getDependency("accessor",input)),h.push(this.getDependency("accessor",output)),c.push(n),l.push(d)}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(h),Promise.all(c),Promise.all(l)]).then((function(r){const o=r[0],h=r[1],c=r[2],l=r[3],d=r[4],m=[];for(let i=0,e=o.length;i<e;i++){const e=o[i],t=h[i],r=c[i],f=l[i],_=d[i];if(void 0===e)continue;let y;switch(e.updateMatrix(),e.matrixAutoUpdate=!0,W[_.path]){case W.weights:y=n.NumberKeyframeTrack;break;case W.rotation:y=n.QuaternionKeyframeTrack;break;default:y=n.VectorKeyframeTrack}const E=e.name?e.name:e.uuid,T=void 0!==f.interpolation?J[f.interpolation]:n.InterpolateLinear,v=[];W[_.path]===W.weights?e.traverse((function(object){object.morphTargetInfluences&&v.push(object.name?object.name:object.uuid)})):v.push(E);let x=r.array;if(r.normalized){const e=ae(x.constructor),t=new Float32Array(x.length);for(let r=0,n=x.length;r<n;r++)t[r]=x[r]*e;x=t}for(let e=0,r=v.length;e<r;e++){const track=new y(v[e]+"."+W[_.path],t.array,x,T);"CUBICSPLINE"===f.interpolation&&(track.createInterpolant=function(e){return new(this instanceof n.QuaternionKeyframeTrack?H:I)(this.times,this.values,this.getValueSize()/3,e)},track.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),m.push(track)}}const f=t.name?t.name:"animation_"+e;return new n.AnimationClip(f,void 0,m)}))}createNodeMesh(e){const t=this.json,r=this,n=t.nodes[e];return void 0===n.mesh?null:r.getDependency("mesh",n.mesh).then((function(e){const t=r._getNodeRef(r.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse((function(e){if(e.isMesh)for(let i=0,t=n.weights.length;i<t;i++)e.morphTargetInfluences[i]=n.weights[i]})),t}))}loadNode(e){const t=this.json,r=this.extensions,o=this,h=t.nodes[e],c=h.name?o.createUniqueName(h.name):"";return function(){const t=[],r=o._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return r&&t.push(r),void 0!==h.camera&&t.push(o.getDependency("camera",h.camera).then((function(e){return o._getNodeRef(o.cameraCache,h.camera,e)}))),o._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){let l;if(l=!0===h.isBone?new n.Bone:t.length>1?new n.Group:1===t.length?t[0]:new n.Object3D,l!==t[0])for(let i=0,e=t.length;i<e;i++)l.add(t[i]);if(h.name&&(l.userData.name=h.name,l.name=c),ie(l,h),h.extensions&&se(r,l,h),void 0!==h.matrix){const e=new n.Matrix4;e.fromArray(h.matrix),l.applyMatrix4(e)}else void 0!==h.translation&&l.position.fromArray(h.translation),void 0!==h.rotation&&l.quaternion.fromArray(h.rotation),void 0!==h.scale&&l.scale.fromArray(h.scale);return o.associations.has(l)||o.associations.set(l,{}),o.associations.get(l).nodes=e,l}))}loadScene(e){const t=this.json,r=this.extensions,o=this.json.scenes[e],h=this,c=new n.Group;o.name&&(c.name=h.createUniqueName(o.name)),ie(c,o),o.extensions&&se(r,c,o);const l=o.nodes||[],d=[];for(let i=0,e=l.length;i<e;i++)d.push(ce(l[i],c,t,h));return Promise.all(d).then((function(){return h.associations=(e=>{const t=new Map;for(const[e,r]of h.associations)(e instanceof n.Material||e instanceof n.Texture)&&t.set(e,r);return e.traverse((e=>{const r=h.associations.get(e);null!=r&&t.set(e,r)})),t})(c),c}))}}function ce(e,t,r,o){const h=r.nodes[e];return o.getDependency("node",e).then((function(e){if(void 0===h.skin)return e;let t;return o.getDependency("skin",h.skin).then((function(e){t=e;const r=[];for(let i=0,e=t.joints.length;i<e;i++)r.push(o.getDependency("node",t.joints[i]));return Promise.all(r)})).then((function(r){return e.traverse((function(e){if(!e.isMesh)return;const o=[],h=[];for(let e=0,c=r.length;e<c;e++){const c=r[e];if(c){o.push(c);const r=new n.Matrix4;void 0!==t.inverseBindMatrices&&r.fromArray(t.inverseBindMatrices.array,16*e),h.push(r)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}e.bind(new n.Skeleton(o,h),e.matrixWorld)})),e}))})).then((function(e){t.add(e);const n=[];if(h.children){const t=h.children;for(let i=0,h=t.length;i<h;i++){const h=t[i];n.push(ce(h,e,r,o))}}return Promise.all(n)}))}function le(e,t,r){const o=t.attributes,h=[];function c(t,n){return r.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const t in o){const r=Q[t]||t.toLowerCase();r in e.attributes||h.push(c(o[t],r))}if(void 0!==t.indices&&!e.index){const n=r.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));h.push(n)}return ie(e,t),function(e,t,r){const o=t.attributes,h=new n.Box3;if(void 0===o.POSITION)return;{const e=r.json.accessors[o.POSITION],t=e.min,c=e.max;if(void 0===t||void 0===c)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(h.set(new n.Vector3(t[0],t[1],t[2]),new n.Vector3(c[0],c[1],c[2])),e.normalized){const t=ae(j[e.componentType]);h.min.multiplyScalar(t),h.max.multiplyScalar(t)}}const c=t.targets;if(void 0!==c){const e=new n.Vector3,t=new n.Vector3;for(let i=0,n=c.length;i<n;i++){const n=c[i];if(void 0!==n.POSITION){const o=r.json.accessors[n.POSITION],h=o.min,c=o.max;if(void 0!==h&&void 0!==c){if(t.setX(Math.max(Math.abs(h[0]),Math.abs(c[0]))),t.setY(Math.max(Math.abs(h[1]),Math.abs(c[1]))),t.setZ(Math.max(Math.abs(h[2]),Math.abs(c[2]))),o.normalized){const e=ae(j[o.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}h.expandByVector(e)}e.boundingBox=h;const l=new n.Sphere;h.getCenter(l.center),l.radius=h.min.distanceTo(h.max)/2,e.boundingSphere=l}(e,t,r),Promise.all(h).then((function(){return void 0!==t.targets?function(e,t,r){let n=!1,o=!1,h=!1;for(let i=0,e=t.length;i<e;i++){const e=t[i];if(void 0!==e.POSITION&&(n=!0),void 0!==e.NORMAL&&(o=!0),void 0!==e.COLOR_0&&(h=!0),n&&o&&h)break}if(!n&&!o&&!h)return Promise.resolve(e);const c=[],l=[],d=[];for(let i=0,m=t.length;i<m;i++){const m=t[i];if(n){const t=void 0!==m.POSITION?r.getDependency("accessor",m.POSITION):e.attributes.position;c.push(t)}if(o){const t=void 0!==m.NORMAL?r.getDependency("accessor",m.NORMAL):e.attributes.normal;l.push(t)}if(h){const t=void 0!==m.COLOR_0?r.getDependency("accessor",m.COLOR_0):e.attributes.color;d.push(t)}}return Promise.all([Promise.all(c),Promise.all(l),Promise.all(d)]).then((function(t){const r=t[0],c=t[1],l=t[2];return n&&(e.morphAttributes.position=r),o&&(e.morphAttributes.normal=c),h&&(e.morphAttributes.color=l),e.morphTargetsRelative=!0,e}))}(e,t.targets,r):e}))}function ue(e,t){let r=e.getIndex();if(null===r){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let i=0;i<n.count;i++)t.push(i);e.setIndex(t),r=e.getIndex()}const o=r.count-2,h=[];if(t===n.TriangleFanDrawMode)for(let i=1;i<=o;i++)h.push(r.getX(0)),h.push(r.getX(i)),h.push(r.getX(i+1));else for(let i=0;i<o;i++)i%2==0?(h.push(r.getX(i)),h.push(r.getX(i+1)),h.push(r.getX(i+2))):(h.push(r.getX(i+2)),h.push(r.getX(i+1)),h.push(r.getX(i)));h.length/3!==o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const c=e.clone();return c.setIndex(h),c}},584:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(175);class o extends n.DataTextureLoader{constructor(e){super(e),this.type=n.HalfFloatType}parse(e){const t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},r=function(e,t,r){t=t||1024;let p=e.pos,i=-1,n=0,s="",o=String.fromCharCode.apply(null,new Uint16Array(e.subarray(p,p+128)));for(;0>(i=o.indexOf("\n"))&&n<t&&p<e.byteLength;)s+=o,n+=o.length,p+=128,o+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(p,p+128)));return-1<i&&(!1!==r&&(e.pos+=n+i+1),s+o.slice(0,i))},o=function(e,t,r,n){const o=e[t+3],h=Math.pow(2,o-128)/255;r[n+0]=e[t+0]*h,r[n+1]=e[t+1]*h,r[n+2]=e[t+2]*h,r[n+3]=1},h=function(e,t,r,o){const h=e[t+3],c=Math.pow(2,h-128)/255;r[o+0]=n.DataUtils.toHalfFloat(Math.min(e[t+0]*c,65504)),r[o+1]=n.DataUtils.toHalfFloat(Math.min(e[t+1]*c,65504)),r[o+2]=n.DataUtils.toHalfFloat(Math.min(e[t+2]*c,65504)),r[o+3]=n.DataUtils.toHalfFloat(1)},c=new Uint8Array(e);c.pos=0;const l=function(e){const n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,h=/^\s*FORMAT=(\S+)\s*$/,c=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,header={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let line,l;if(e.pos>=e.byteLength||!(line=r(e)))return t(1,"no header found");if(!(l=line.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(header.valid|=1,header.programtype=l[1],header.string+=line+"\n";line=r(e),!1!==line;)if(header.string+=line+"\n","#"!==line.charAt(0)){if((l=line.match(n))&&(header.gamma=parseFloat(l[1])),(l=line.match(o))&&(header.exposure=parseFloat(l[1])),(l=line.match(h))&&(header.valid|=2,header.format=l[1]),(l=line.match(c))&&(header.valid|=4,header.height=parseInt(l[1],10),header.width=parseInt(l[2],10)),2&header.valid&&4&header.valid)break}else header.comments+=line+"\n";return 2&header.valid?4&header.valid?header:t(3,"missing image size specifier"):t(3,"missing format specifier")}(c);if(-1!==l){const e=l.width,r=l.height,d=function(e,r,n){const o=r;if(o<8||o>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(o!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");const h=new Uint8Array(4*r*n);if(!h.length)return t(4,"unable to allocate buffer space");let c=0,l=0;const d=4*o,m=new Uint8Array(4),f=new Uint8Array(d);let _=n;for(;_>0&&l<e.byteLength;){if(l+4>e.byteLength)return t(1);if(m[0]=e[l++],m[1]=e[l++],m[2]=e[l++],m[3]=e[l++],2!=m[0]||2!=m[1]||(m[2]<<8|m[3])!=o)return t(3,"bad rgbe scanline format");let r,n=0;for(;n<d&&l<e.byteLength;){r=e[l++];const o=r>128;if(o&&(r-=128),0===r||n+r>d)return t(3,"bad scanline data");if(o){const t=e[l++];for(let i=0;i<r;i++)f[n++]=t}else f.set(e.subarray(l,l+r),n),n+=r,l+=r}const y=o;for(let i=0;i<y;i++){let e=0;h[c]=f[i+e],e+=o,h[c+1]=f[i+e],e+=o,h[c+2]=f[i+e],e+=o,h[c+3]=f[i+e],c+=4}_--}return h}(c.subarray(c.pos),e,r);if(-1!==d){let data,t,c,m;switch(this.type){case n.FloatType:m=d.length/4;const e=new Float32Array(4*m);for(let t=0;t<m;t++)o(d,4*t,e,4*t);data=e,c=n.FloatType;break;case n.HalfFloatType:m=d.length/4;const t=new Uint16Array(4*m);for(let e=0;e<m;e++)h(d,4*e,t,4*e);data=t,c=n.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:e,height:r,data:data,header:l.string,gamma:l.gamma,exposure:l.exposure,format:t,type:c}}}return null}setDataType(e){return this.type=e,this}load(e,t,r,o){return super.load(e,(function(e,r){switch(e.type){case n.FloatType:case n.HalfFloatType:e.encoding=n.LinearEncoding,e.minFilter=n.LinearFilter,e.magFilter=n.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)}),r,o)}}},585:function(e,t,r){"use strict";var n;function o(e){return e.isPerspectiveCamera}function h(e){return e.isOrthographicCamera}r.d(t,"a",(function(){return W})),function(e){e[e.NONE=0]="NONE",e[e.ROTATE=1]="ROTATE",e[e.TRUCK=2]="TRUCK",e[e.OFFSET=3]="OFFSET",e[e.DOLLY=4]="DOLLY",e[e.ZOOM=5]="ZOOM",e[e.TOUCH_ROTATE=6]="TOUCH_ROTATE",e[e.TOUCH_TRUCK=7]="TOUCH_TRUCK",e[e.TOUCH_OFFSET=8]="TOUCH_OFFSET",e[e.TOUCH_DOLLY=9]="TOUCH_DOLLY",e[e.TOUCH_ZOOM=10]="TOUCH_ZOOM",e[e.TOUCH_DOLLY_TRUCK=11]="TOUCH_DOLLY_TRUCK",e[e.TOUCH_DOLLY_OFFSET=12]="TOUCH_DOLLY_OFFSET",e[e.TOUCH_ZOOM_TRUCK=13]="TOUCH_ZOOM_TRUCK",e[e.TOUCH_ZOOM_OFFSET=14]="TOUCH_ZOOM_OFFSET"}(n||(n={}));const c=2*Math.PI,l=Math.PI/2;function d(e,t=1e-5){return Math.abs(e)<t}function m(a,b,e=1e-5){return d(a-b,e)}function f(e,t){return Math.round(e/t)*t}function _(e){return isFinite(e)?e:e<0?-Number.MAX_VALUE:Number.MAX_VALUE}function y(e){return Math.abs(e)<Number.MAX_VALUE?e:e*(1/0)}function E(e,t){t.set(0,0),e.forEach((e=>{t.x+=e.clientX,t.y+=e.clientY})),t.x/=e.length,t.y/=e.length}function T(e,t){return!!h(e)&&(console.warn(`${t} is not supported in OrthographicCamera`),!0)}function v(e){return e.invert?e.invert():e.inverse(),e}const x="undefined"!=typeof window,M=x&&/Mac/.test(navigator.platform),R=!(x&&"PointerEvent"in window),w=Object.freeze(n),O=1/8;let A,S,L,C,P,U,F,I,D,H,N,k,z,B,V,K,G,j,X,Y,Z,Q;class W extends class{constructor(){this._listeners={}}addEventListener(e,t){const r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}removeEventListener(e,t){const r=this._listeners[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}removeAllEventListeners(e){e?Array.isArray(this._listeners[e])&&(this._listeners[e].length=0):this._listeners={}}dispatchEvent(e){const t=this._listeners[e.type];if(void 0!==t){e.target=this;const r=t.slice(0);for(let i=0,t=r.length;i<t;i++)r[i].call(this,e)}}}{constructor(e,t){if(super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=0,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.dampingFactor=.05,this.draggingDampingFactor=.25,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=n.NONE,this._viewport=null,this._dollyControlAmount=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._activePointers=[],this._truckInternal=(e,t,r)=>{if(o(this._camera)){const n=U.copy(this._camera.position).sub(this._target),o=this._camera.getEffectiveFOV()*A.MathUtils.DEG2RAD,h=n.length()*Math.tan(.5*o),c=this.truckSpeed*e*h/this._elementRect.height,l=this.truckSpeed*t*h/this._elementRect.height;this.verticalDragToForward?(r?this.setFocalOffset(this._focalOffsetEnd.x+c,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(c,0,!0),this.forward(-l,!0)):r?this.setFocalOffset(this._focalOffsetEnd.x+c,this._focalOffsetEnd.y+l,this._focalOffsetEnd.z,!0):this.truck(c,l,!0)}else if(h(this._camera)){const n=this._camera,o=e*(n.right-n.left)/n.zoom/this._elementRect.width,h=t*(n.top-n.bottom)/n.zoom/this._elementRect.height;r?this.setFocalOffset(this._focalOffsetEnd.x+o,this._focalOffsetEnd.y+h,this._focalOffsetEnd.z,!0):this.truck(o,h,!0)}},this._rotateInternal=(e,t)=>{const r=c*this.azimuthRotateSpeed*e/this._elementRect.height,n=c*this.polarRotateSpeed*t/this._elementRect.height;this.rotate(r,n,!0)},this._dollyInternal=(e,t,r)=>{const n=Math.pow(.95,-e*this.dollySpeed),o=this._sphericalEnd.radius*n,h=this._sphericalEnd.radius,c=h*(e>=0?-1:1);this.dollyTo(o),this.infinityDolly&&(o<this.minDistance||this.maxDistance===this.minDistance)&&(this._camera.getWorldDirection(U),this._targetEnd.add(U.normalize().multiplyScalar(c)),this._target.add(U.normalize().multiplyScalar(c))),this.dollyToCursor&&(this._dollyControlAmount+=this._sphericalEnd.radius-h,this.infinityDolly&&(o<this.minDistance||this.maxDistance===this.minDistance)&&(this._dollyControlAmount-=c),this._dollyControlCoord.set(t,r))},this._zoomInternal=(e,t,r)=>{const n=Math.pow(.95,e*this.dollySpeed);this.zoomTo(this._zoom*n),this.dollyToCursor&&(this._dollyControlAmount=this._zoomEnd,this._dollyControlCoord.set(t,r))},void 0===A&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=(new A.Quaternion).setFromUnitVectors(this._camera.up,L),this._yAxisUpSpaceInverse=v(this._yAxisUpSpace.clone()),this._state=n.NONE,this._domElement=t,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._target=new A.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new A.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=(new A.Spherical).setFromVector3(U.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._nearPlaneCorners=[new A.Vector3,new A.Vector3,new A.Vector3,new A.Vector3],this._updateNearPlaneCorners(),this._boundary=new A.Box3(new A.Vector3(-1/0,-1/0,-1/0),new A.Vector3(1/0,1/0,1/0)),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlAmount=0,this._dollyControlCoord=new A.Vector2,this.mouseButtons={left:n.ROTATE,middle:n.DOLLY,right:n.TRUCK,wheel:o(this._camera)?n.DOLLY:h(this._camera)?n.ZOOM:n.NONE,shiftLeft:n.NONE},this.touches={one:n.TOUCH_ROTATE,two:o(this._camera)?n.TOUCH_DOLLY_TRUCK:h(this._camera)?n.TOUCH_ZOOM_TRUCK:n.NONE,three:n.TOUCH_TRUCK},this._domElement){const e=new A.Vector2,t=new A.Vector2,r=new A.Vector2,o=e=>{if(!this._enabled)return;const t={pointerId:e.pointerId,clientX:e.clientX,clientY:e.clientY};switch(this._activePointers.push(t),e.button){case A.MOUSE.LEFT:this._state=e.shiftKey?this.mouseButtons.shiftLeft:this.mouseButtons.left;break;case A.MOUSE.MIDDLE:this._state=this.mouseButtons.middle;break;case A.MOUSE.RIGHT:this._state=this.mouseButtons.right}if("touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",f),this._domElement.ownerDocument.addEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",f),w()},h=e=>{if(!this._enabled)return;const t={pointerId:0,clientX:e.clientX,clientY:e.clientY};switch(this._activePointers.push(t),e.button){case A.MOUSE.LEFT:this._state=e.shiftKey?this.mouseButtons.shiftLeft:this.mouseButtons.left;break;case A.MOUSE.MIDDLE:this._state=this.mouseButtons.middle;break;case A.MOUSE.RIGHT:this._state=this.mouseButtons.right}this._domElement.ownerDocument.removeEventListener("mousemove",d),this._domElement.ownerDocument.removeEventListener("mouseup",_),this._domElement.ownerDocument.addEventListener("mousemove",d),this._domElement.ownerDocument.addEventListener("mouseup",_),w()},c=e=>{if(this._enabled){switch(e.preventDefault(),Array.prototype.forEach.call(e.changedTouches,(e=>{const t={pointerId:e.identifier,clientX:e.clientX,clientY:e.clientY};this._activePointers.push(t)})),this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}this._domElement.ownerDocument.removeEventListener("touchmove",m,{passive:!1}),this._domElement.ownerDocument.removeEventListener("touchend",y),this._domElement.ownerDocument.addEventListener("touchmove",m,{passive:!1}),this._domElement.ownerDocument.addEventListener("touchend",y),w()}},l=e=>{e.cancelable&&e.preventDefault();const t=e.pointerId,r=this._findPointerById(t);r&&(r.clientX=e.clientX,r.clientY=e.clientY,S())},d=e=>{const t=this._findPointerById(0);t&&(t.clientX=e.clientX,t.clientY=e.clientY,S())},m=e=>{e.cancelable&&e.preventDefault(),Array.prototype.forEach.call(e.changedTouches,(e=>{const t=e.identifier,r=this._findPointerById(t);r&&(r.clientX=e.clientX,r.clientY=e.clientY)})),S()},f=e=>{const t=e.pointerId,r=this._findPointerById(t);if(r&&this._activePointers.splice(this._activePointers.indexOf(r),1),"touch"===e.pointerType)switch(this._activePointers.length){case 0:this._state=n.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=n.NONE;L()},_=()=>{const e=this._findPointerById(0);e&&this._activePointers.splice(this._activePointers.indexOf(e),1),this._state=n.NONE,L()},y=e=>{switch(Array.prototype.forEach.call(e.changedTouches,(e=>{const t=e.identifier,r=this._findPointerById(t);r&&this._activePointers.splice(this._activePointers.indexOf(r),1)})),this._activePointers.length){case 0:this._state=n.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}L()};let T=-1;const v=e=>{if(!this._enabled||this.mouseButtons.wheel===n.NONE)return;if(e.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===n.ROTATE||this.mouseButtons.wheel===n.TRUCK){const e=performance.now();T-e<1e3&&this._getClientRect(this._elementRect),T=e}const t=M?-1:-3,r=1===e.deltaMode?e.deltaY/t:e.deltaY/(10*t),o=this.dollyToCursor?(e.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,h=this.dollyToCursor?(e.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case n.ROTATE:this._rotateInternal(e.deltaX,e.deltaY);break;case n.TRUCK:this._truckInternal(e.deltaX,e.deltaY,!1);break;case n.OFFSET:this._truckInternal(e.deltaX,e.deltaY,!0);break;case n.DOLLY:this._dollyInternal(-r,o,h);break;case n.ZOOM:this._zoomInternal(-r,o,h)}this.dispatchEvent({type:"control"})},x=e=>{this._enabled&&e.preventDefault()},w=()=>{if(!this._enabled)return;E(this._activePointers,P),this._getClientRect(this._elementRect),e.copy(P),t.copy(P);if(this._activePointers.length>=2){const e=P.x-this._activePointers[1].clientX,n=P.y-this._activePointers[1].clientY,o=Math.sqrt(e*e+n*n);r.set(0,o);const h=.5*(this._activePointers[0].clientX+this._activePointers[1].clientX),c=.5*(this._activePointers[0].clientY+this._activePointers[1].clientY);t.set(h,c)}this.dispatchEvent({type:"controlstart"})},S=()=>{if(!this._enabled)return;E(this._activePointers,P);const o=t.x-P.x,h=t.y-P.y;switch(t.copy(P),this._state){case n.ROTATE:case n.TOUCH_ROTATE:this._rotateInternal(o,h);break;case n.DOLLY:case n.ZOOM:{const t=this.dollyToCursor?(e.x-this._elementRect.x)/this._elementRect.width*2-1:0,r=this.dollyToCursor?(e.y-this._elementRect.y)/this._elementRect.height*-2+1:0;this._state===n.DOLLY?this._dollyInternal(h*O,t,r):this._zoomInternal(h*O,t,r);break}case n.TOUCH_DOLLY:case n.TOUCH_ZOOM:case n.TOUCH_DOLLY_TRUCK:case n.TOUCH_ZOOM_TRUCK:case n.TOUCH_DOLLY_OFFSET:case n.TOUCH_ZOOM_OFFSET:{const e=P.x-this._activePointers[1].clientX,c=P.y-this._activePointers[1].clientY,l=Math.sqrt(e*e+c*c),d=r.y-l;r.set(0,l);const m=this.dollyToCursor?(t.x-this._elementRect.x)/this._elementRect.width*2-1:0,f=this.dollyToCursor?(t.y-this._elementRect.y)/this._elementRect.height*-2+1:0;this._state===n.TOUCH_DOLLY||this._state===n.TOUCH_DOLLY_TRUCK||this._state===n.TOUCH_DOLLY_OFFSET?this._dollyInternal(d*O,m,f):this._zoomInternal(d*O,m,f),this._state===n.TOUCH_DOLLY_TRUCK||this._state===n.TOUCH_ZOOM_TRUCK?this._truckInternal(o,h,!1):this._state!==n.TOUCH_DOLLY_OFFSET&&this._state!==n.TOUCH_ZOOM_OFFSET||this._truckInternal(o,h,!0);break}case n.TRUCK:case n.TOUCH_TRUCK:this._truckInternal(o,h,!1);break;case n.OFFSET:case n.TOUCH_OFFSET:this._truckInternal(o,h,!0)}this.dispatchEvent({type:"control"})},L=()=>{E(this._activePointers,P),t.copy(P),0===this._activePointers.length&&(this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",f),this._domElement.ownerDocument.removeEventListener("touchmove",m,{passive:!1}),this._domElement.ownerDocument.removeEventListener("touchend",y),this.dispatchEvent({type:"controlend"}))};this._domElement.addEventListener("pointerdown",o),R&&this._domElement.addEventListener("mousedown",h),R&&this._domElement.addEventListener("touchstart",c),this._domElement.addEventListener("pointercancel",f),this._domElement.addEventListener("wheel",v,{passive:!1}),this._domElement.addEventListener("contextmenu",x),this._removeAllEventListeners=()=>{this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("mousedown",h),this._domElement.removeEventListener("touchstart",c),this._domElement.removeEventListener("pointercancel",f),this._domElement.removeEventListener("wheel",v,{passive:!1}),this._domElement.removeEventListener("contextmenu",x),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",d),this._domElement.ownerDocument.removeEventListener("touchmove",m,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",f),this._domElement.ownerDocument.removeEventListener("mouseup",_),this._domElement.ownerDocument.removeEventListener("touchend",y)},this.cancel=()=>{this._state!==n.NONE&&(this._state=n.NONE,this._activePointers.length=0,L())}}this.update(0)}static install(e){A=e.THREE,S=Object.freeze(new A.Vector3(0,0,0)),L=Object.freeze(new A.Vector3(0,1,0)),C=Object.freeze(new A.Vector3(0,0,1)),P=new A.Vector2,U=new A.Vector3,F=new A.Vector3,I=new A.Vector3,D=new A.Vector3,H=new A.Vector3,N=new A.Vector3,k=new A.Vector3,z=new A.Vector3,B=new A.Spherical,V=new A.Spherical,K=new A.Box3,G=new A.Box3,j=new A.Sphere,X=new A.Quaternion,Y=new A.Quaternion,Z=new A.Matrix4,Q=new A.Raycaster}static get ACTION(){return w}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="")}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,r=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,r)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,r=!1){const n=A.MathUtils.clamp(e,this.minAzimuthAngle,this.maxAzimuthAngle),o=A.MathUtils.clamp(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=n,this._sphericalEnd.phi=o,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,r||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const h=!r||m(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&m(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(h)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){const r=this._sphericalEnd.radius,n=A.MathUtils.clamp(e,this.minDistance,this.maxDistance);if(this.colliderMeshes.length>=1){const e=this._collisionTest(),t=m(e,this._spherical.radius);if(!(r>n)&&t)return Promise.resolve();this._sphericalEnd.radius=Math.min(n,e)}else this._sphericalEnd.radius=n;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const o=!t||m(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(o)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._zoomEnd=A.MathUtils.clamp(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const r=!t||m(this._zoom,this._zoomEnd,this.restThreshold);return this._createOnRestPromise(r)}pan(e,t,r=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,r)}truck(e,t,r=!1){this._camera.updateMatrix(),D.setFromMatrixColumn(this._camera.matrix,0),H.setFromMatrixColumn(this._camera.matrix,1),D.multiplyScalar(e),H.multiplyScalar(-t);const n=U.copy(D).add(H),o=F.copy(this._targetEnd).add(n);return this.moveTo(o.x,o.y,o.z,r)}forward(e,t=!1){U.setFromMatrixColumn(this._camera.matrix,0),U.crossVectors(this._camera.up,U),U.multiplyScalar(e);const r=F.copy(this._targetEnd).add(U);return this.moveTo(r.x,r.y,r.z,t)}moveTo(e,t,r,n=!1){const o=U.set(e,t,r).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,o,this.boundaryFriction),this._needsUpdate=!0,n||this._target.copy(this._targetEnd);const h=!n||m(this._target.x,this._targetEnd.x,this.restThreshold)&&m(this._target.y,this._targetEnd.y,this.restThreshold)&&m(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(h)}fitToBox(e,t,{paddingLeft:r=0,paddingRight:n=0,paddingBottom:c=0,paddingTop:d=0}={}){const _=[],y=e.isBox3?K.copy(e):K.setFromObject(e);y.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const E=f(this._sphericalEnd.theta,l),T=f(this._sphericalEnd.phi,l);_.push(this.rotateTo(E,T,t));const v=U.setFromSpherical(this._sphericalEnd).normalize(),x=X.setFromUnitVectors(v,C);m(Math.abs(v.y),1)&&x.multiply(Y.setFromAxisAngle(L,E));const M=G.makeEmpty();F.copy(y.min).applyQuaternion(x),M.expandByPoint(F),F.copy(y.min).setX(y.max.x).applyQuaternion(x),M.expandByPoint(F),F.copy(y.min).setY(y.max.y).applyQuaternion(x),M.expandByPoint(F),F.copy(y.max).setZ(y.min.z).applyQuaternion(x),M.expandByPoint(F),F.copy(y.min).setZ(y.max.z).applyQuaternion(x),M.expandByPoint(F),F.copy(y.max).setY(y.min.y).applyQuaternion(x),M.expandByPoint(F),F.copy(y.max).setX(y.min.x).applyQuaternion(x),M.expandByPoint(F),F.copy(y.max).applyQuaternion(x),M.expandByPoint(F),x.setFromUnitVectors(C,v),M.min.x-=r,M.min.y-=c,M.max.x+=n,M.max.y+=d;const R=M.getSize(U),w=M.getCenter(F).applyQuaternion(x);if(o(this._camera)){const e=this.getDistanceToFitBox(R.x,R.y,R.z);_.push(this.moveTo(w.x,w.y,w.z,t)),_.push(this.dollyTo(e,t)),_.push(this.setFocalOffset(0,0,0,t))}else if(h(this._camera)){const e=this._camera,r=e.right-e.left,n=e.top-e.bottom,o=Math.min(r/R.x,n/R.y);_.push(this.moveTo(w.x,w.y,w.z,t)),_.push(this.zoomTo(o,t)),_.push(this.setFocalOffset(0,0,0,t))}return Promise.all(_)}fitToSphere(e,t){const r=[],n=e instanceof A.Sphere?j.copy(e):function(e,t){const r=t,n=r.center;K.makeEmpty(),e.traverseVisible((object=>{object.isMesh&&K.expandByObject(object)})),K.getCenter(n);let o=0;return e.traverseVisible((object=>{if(!object.isMesh)return;const e=object,t=e.geometry.clone();if(t.applyMatrix4(e.matrixWorld),t.isBufferGeometry){const e=t.attributes.position;for(let i=0,t=e.count;i<t;i++)U.fromBufferAttribute(e,i),o=Math.max(o,n.distanceToSquared(U))}else{const e=t.attributes.position,r=new A.Vector3;for(let i=0,t=e.count;i<t;i++)r.fromBufferAttribute(e,i),o=Math.max(o,n.distanceToSquared(r))}})),r.radius=Math.sqrt(o),r}(e,j);if(r.push(this.moveTo(n.center.x,n.center.y,n.center.z,t)),o(this._camera)){const e=this.getDistanceToFitSphere(n.radius);r.push(this.dollyTo(e,t))}else if(h(this._camera)){const e=this._camera.right-this._camera.left,o=this._camera.top-this._camera.bottom,h=2*n.radius,c=Math.min(e/h,o/h);r.push(this.zoomTo(c,t))}return r.push(this.setFocalOffset(0,0,0,t)),Promise.all(r)}setLookAt(e,t,r,n,o,h,c=!1){const l=F.set(n,o,h),d=U.set(e,t,r);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(d.sub(l).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,c||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const f=!c||m(this._target.x,this._targetEnd.x,this.restThreshold)&&m(this._target.y,this._targetEnd.y,this.restThreshold)&&m(this._target.z,this._targetEnd.z,this.restThreshold)&&m(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&m(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&m(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(f)}lerpLookAt(e,t,r,n,o,h,c,l,d,f,_,y,E,T=!1){const v=U.set(n,o,h),x=F.set(e,t,r);B.setFromVector3(x.sub(v).applyQuaternion(this._yAxisUpSpace));const M=I.set(f,_,y),R=F.set(c,l,d);V.setFromVector3(R.sub(M).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(v.lerp(M,E));const w=V.theta-B.theta,O=V.phi-B.phi,A=V.radius-B.radius;this._sphericalEnd.set(B.radius+A*E,B.phi+O*E,B.theta+w*E),this.normalizeRotations(),this._needsUpdate=!0,T||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const S=!T||m(this._target.x,this._targetEnd.x,this.restThreshold)&&m(this._target.y,this._targetEnd.y,this.restThreshold)&&m(this._target.z,this._targetEnd.z,this.restThreshold)&&m(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&m(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&m(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(S)}setPosition(e,t,r,n=!1){return this.setLookAt(e,t,r,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,n)}setTarget(e,t,r,n=!1){const o=this.getPosition(U);return this.setLookAt(o.x,o.y,o.z,e,t,r,n)}setFocalOffset(e,t,r,n=!1){this._focalOffsetEnd.set(e,t,r),this._needsUpdate=!0,n||this._focalOffset.copy(this._focalOffsetEnd);const o=!n||m(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&m(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&m(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}setOrbitPoint(e,t,r){D.setFromMatrixColumn(this._camera.matrixWorldInverse,0),H.setFromMatrixColumn(this._camera.matrixWorldInverse,1),N.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const n=U.set(e,t,r),o=n.distanceTo(this._camera.position),h=n.sub(this._camera.position);D.multiplyScalar(h.x),H.multiplyScalar(h.y),N.multiplyScalar(h.z),U.copy(D).add(H).add(N),U.z=U.z+o,this.dollyTo(o,!1),this.setFocalOffset(-U.x,U.y,-U.z,!1),this.moveTo(e,t,r,!1)}setBoundary(e){if(!e)return this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),void(this._needsUpdate=!0);this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,r,n){null!==e?(this._viewport=this._viewport||new A.Vector4,"number"==typeof e?this._viewport.set(e,t,r,n):this._viewport.copy(e)):this._viewport=null}getDistanceToFitBox(e,t,r){if(T(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const n=e/t,o=this._camera.getEffectiveFOV()*A.MathUtils.DEG2RAD,h=this._camera.aspect;return.5*(n<h?t:e/h)/Math.tan(.5*o)+.5*r}getDistanceToFitSphere(e){if(T(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*A.MathUtils.DEG2RAD,r=2*Math.atan(Math.tan(.5*t)*this._camera.aspect),n=1<this._camera.aspect?t:r;return e/Math.sin(.5*n)}getTarget(e){return(e&&e.isVector3?e:new A.Vector3).copy(this._targetEnd)}getPosition(e){return(e&&e.isVector3?e:new A.Vector3).setFromSpherical(this._sphericalEnd).applyQuaternion(this._yAxisUpSpaceInverse).add(this._targetEnd)}getFocalOffset(e){return(e&&e.isVector3?e:new A.Vector3).copy(this._focalOffsetEnd)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%c,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=c),this._spherical.theta+=c*Math.round((this._sphericalEnd.theta-this._spherical.theta)/c)}reset(e=!1){const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._target0.copy(this._target),this._position0.copy(this._camera.position),this._zoom0=this._zoom}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,L),v(this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace))}update(e){const t=this._state===n.NONE?this.dampingFactor:this.draggingDampingFactor,r=Math.min(t*e*60,1),c=this._sphericalEnd.theta-this._spherical.theta,l=this._sphericalEnd.phi-this._spherical.phi,m=this._sphericalEnd.radius-this._spherical.radius,f=k.subVectors(this._targetEnd,this._target),_=z.subVectors(this._focalOffsetEnd,this._focalOffset);if(d(c)&&d(l)&&d(m)&&d(f.x)&&d(f.y)&&d(f.z)&&d(_.x)&&d(_.y)&&d(_.z)?(this._spherical.copy(this._sphericalEnd),this._target.copy(this._targetEnd),this._focalOffset.copy(this._focalOffsetEnd)):(this._spherical.set(this._spherical.radius+m*r,this._spherical.phi+l*r,this._spherical.theta+c*r),this._target.add(f.multiplyScalar(r)),this._focalOffset.add(_.multiplyScalar(r)),this._needsUpdate=!0),0!==this._dollyControlAmount){if(o(this._camera)){const e=this._camera,t=U.setFromSpherical(this._sphericalEnd).applyQuaternion(this._yAxisUpSpaceInverse).normalize().negate(),r=F.copy(t).cross(e.up).normalize();0===r.lengthSq()&&(r.x=1);const n=I.crossVectors(r,t),o=this._sphericalEnd.radius*Math.tan(e.getEffectiveFOV()*A.MathUtils.DEG2RAD*.5),h=(this._sphericalEnd.radius-this._dollyControlAmount-this._sphericalEnd.radius)/this._sphericalEnd.radius,cursor=U.copy(this._targetEnd).add(r.multiplyScalar(this._dollyControlCoord.x*o*e.aspect)).add(n.multiplyScalar(this._dollyControlCoord.y*o));this._targetEnd.lerp(cursor,h),this._target.copy(this._targetEnd)}else if(h(this._camera)){const e=this._camera,t=U.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(e.near+e.far)/(e.near-e.far)).unproject(e),r=F.set(0,0,-1).applyQuaternion(e.quaternion),n=r.dot(e.up),o=d(n)?-t.dot(e.up):-t.dot(e.up)/n,cursor=I.copy(t).add(r.multiplyScalar(o));this._targetEnd.lerp(cursor,1-e.zoom/this._dollyControlAmount),this._target.copy(this._targetEnd)}this._dollyControlAmount=0}const y=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,y),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target);(!d(this._focalOffset.x)||!d(this._focalOffset.y)||!d(this._focalOffset.z))&&(this._camera.updateMatrix(),D.setFromMatrixColumn(this._camera.matrix,0),H.setFromMatrixColumn(this._camera.matrix,1),N.setFromMatrixColumn(this._camera.matrix,2),D.multiplyScalar(this._focalOffset.x),H.multiplyScalar(-this._focalOffset.y),N.multiplyScalar(this._focalOffset.z),U.copy(D).add(H).add(N),this._camera.position.add(U)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),U.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const E=this._zoomEnd-this._zoom;this._zoom+=E*r,this._camera.zoom!==this._zoom&&(d(E)&&(this._zoom=this._zoomEnd),this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0);const T=this._needsUpdate;return T&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):T?(this.dispatchEvent({type:"update"}),d(c,this.restThreshold)&&d(l,this.restThreshold)&&d(m,this.restThreshold)&&d(f.x,this.restThreshold)&&d(f.y,this.restThreshold)&&d(f.z,this.restThreshold)&&d(_.x,this.restThreshold)&&d(_.y,this.restThreshold)&&d(_.z,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!T&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._updatedLastTime=T,this._needsUpdate=!1,T}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:_(this.maxDistance),minZoom:this.minZoom,maxZoom:_(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:_(this.maxPolarAngle),minAzimuthAngle:_(this.minAzimuthAngle),maxAzimuthAngle:_(this.maxAzimuthAngle),dampingFactor:this.dampingFactor,draggingDampingFactor:this.draggingDampingFactor,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:U.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const r=JSON.parse(e),n=U.fromArray(r.position);this.enabled=r.enabled,this.minDistance=r.minDistance,this.maxDistance=y(r.maxDistance),this.minZoom=r.minZoom,this.maxZoom=y(r.maxZoom),this.minPolarAngle=r.minPolarAngle,this.maxPolarAngle=y(r.maxPolarAngle),this.minAzimuthAngle=y(r.minAzimuthAngle),this.maxAzimuthAngle=y(r.maxAzimuthAngle),this.dampingFactor=r.dampingFactor,this.draggingDampingFactor=r.draggingDampingFactor,this.dollySpeed=r.dollySpeed,this.truckSpeed=r.truckSpeed,this.dollyToCursor=r.dollyToCursor,this.verticalDragToForward=r.verticalDragToForward,this._target0.fromArray(r.target0),this._position0.fromArray(r.position0),this._zoom0=r.zoom0,this._focalOffset0.fromArray(r.focalOffset0),this.moveTo(r.target[0],r.target[1],r.target[2],t),B.setFromVector3(n.sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(B.theta,B.phi,t),this.zoomTo(r.zoom,t),this.setFocalOffset(r.focalOffset[0],r.focalOffset[1],r.focalOffset[2],t),this._needsUpdate=!0}dispose(){this._removeAllEventListeners()}_findPointerById(e){let t=null;return this._activePointers.some((r=>r.pointerId===e&&(t=r,!0))),t}_encloseToBoundary(e,t,r){const n=t.lengthSq();if(0===n)return e;const o=F.copy(t).add(e),h=this._boundary.clampPoint(o,I).sub(o),c=h.lengthSq();if(0===c)return e.add(t);if(c===n)return e;if(0===r)return e.add(t).add(h);{const n=1+r*c/t.dot(h);return e.add(F.copy(t).multiplyScalar(n)).add(h.multiplyScalar(1-r))}}_updateNearPlaneCorners(){if(o(this._camera)){const e=this._camera,t=e.near,r=e.getEffectiveFOV()*A.MathUtils.DEG2RAD,n=Math.tan(.5*r)*t,o=n*e.aspect;this._nearPlaneCorners[0].set(-o,-n,0),this._nearPlaneCorners[1].set(o,-n,0),this._nearPlaneCorners[2].set(o,n,0),this._nearPlaneCorners[3].set(-o,n,0)}else if(h(this._camera)){const e=this._camera,t=1/e.zoom,r=e.left*t,n=e.right*t,o=e.top*t,h=e.bottom*t;this._nearPlaneCorners[0].set(r,o,0),this._nearPlaneCorners[1].set(n,o,0),this._nearPlaneCorners[2].set(n,h,0),this._nearPlaneCorners[3].set(r,h,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1))return e;if(T(this._camera,"_collisionTest"))return e;const t=U.setFromSpherical(this._spherical).divideScalar(this._spherical.radius);Z.lookAt(S,t,this._camera.up);for(let i=0;i<4;i++){const r=F.copy(this._nearPlaneCorners[i]);r.applyMatrix4(Z);const n=I.addVectors(this._target,r);Q.set(n,t),Q.far=this._spherical.radius+1;const o=Q.intersectObjects(this.colliderMeshes);0!==o.length&&o[0].distance<e&&(e=o[0].distance)}return e}_getClientRect(e){const rect=this._domElement.getBoundingClientRect();return e.x=rect.left,e.y=rect.top,this._viewport?(e.x+=this._viewport.x,e.y+=rect.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=rect.width,e.height=rect.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise((e=>{const t=()=>{this.removeEventListener("rest",t),e()};this.addEventListener("rest",t)})))}_removeAllEventListeners(){}}},597:function(e,t,r){"use strict";r(9),r(4),r(10),r(93),r(33),r(346),r(271),r(94),r(111);var n=r(2);var o,h=r(47);t.a=(o="container",n.a.extend({name:"v-".concat(o),functional:!0,props:{id:String,tag:{type:String,default:"div"}},render:function(e,t){var r=t.props,data=t.data,n=t.children;data.staticClass="".concat(o," ").concat(data.staticClass||"").trim();var h=data.attrs;if(h){data.attrs={};var c=Object.keys(h).filter((function(e){if("slot"===e)return!1;var t=h[e];return e.startsWith("data-")?(data.attrs[e]=t,!1):t||"string"==typeof t}));c.length&&(data.staticClass+=" ".concat(c.join(" ")))}return r.id&&(data.domProps=data.domProps||{},data.domProps.id=r.id),e(r.tag,data,n)}})).extend({name:"v-container",functional:!0,props:{id:String,tag:{type:String,default:"div"},fluid:{type:Boolean,default:!1}},render:function(e,t){var r,n=t.props,data=t.data,o=t.children,c=data.attrs;return c&&(data.attrs={},r=Object.keys(c).filter((function(e){if("slot"===e)return!1;var t=c[e];return e.startsWith("data-")?(data.attrs[e]=t,!1):t||"string"==typeof t}))),n.id&&(data.domProps=data.domProps||{},data.domProps.id=n.id),e(n.tag,Object(h.a)(data,{staticClass:"container",class:Array({"container--fluid":n.fluid}).concat(r||[])}),o)}})}}]);